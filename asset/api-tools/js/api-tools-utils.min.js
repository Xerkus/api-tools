;(function(window){var undefined;var arrayPool=[],objectPool=[];var idCounter=0;var indicatorObject={};var keyPrefix=+new Date+'';var largeArraySize=75;var maxPoolSize=40;var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reInterpolate=/<%=([\s\S]+?)%>/g;var reThis=(reThis=/\bthis\b/)&&reThis.test(runInContext)&&reThis;var whitespace=(' \t\x0B\f\xA0\ufeff'+'\n\r\u2028\u2029'+'\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000');var reLeadingSpacesAndZeros=RegExp('^['+whitespace+']*0+(?=.$)');var reNoMatch=/($^)/;var reUnescapedHtml=/[&<>"']/g;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var contextProps=['Array','Boolean','Date','Function','Math','Number','Object','RegExp','String','_','attachEvent','clearTimeout','isFinite','isNaN','parseInt','setImmediate','setTimeout'];var templateCounter=0;var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',errorClass='[object Error]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var cloneableClasses={};cloneableClasses[funcClass]=false;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\t':'t','\u2028':'u2028','\u2029':'u2029'};var freeExports=objectTypes[typeof exports]&&exports;var freeModule=objectTypes[typeof module]&&module&&module.exports==freeExports&&module;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){window=freeGlobal;}
function basicIndexOf(array,value,fromIndex){var index=(fromIndex||0)-1,length=array.length;while(++index<length){if(array[index]===value){return index;}}
return-1;}
function cacheIndexOf(cache,value){var type=typeof value;cache=cache.cache;if(type=='boolean'||value==null){return cache[value];}
if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value;cache=cache[type]||(cache[type]={});return type=='object'?(cache[key]&&basicIndexOf(cache[key],value)>-1?0:-1):(cache[key]?0:-1);}
function cachePush(value){var cache=this.cache,type=typeof value;if(type=='boolean'||value==null){cache[value]=true;}else{if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value,typeCache=cache[type]||(cache[type]={});if(type=='object'){if((typeCache[key]||(typeCache[key]=[])).push(value)==this.array.length){cache[type]=false;}}else{typeCache[key]=true;}}}
function charAtCallback(value){return value.charCodeAt(0);}
function compareAscending(a,b){var ai=a.index,bi=b.index;a=a.criteria;b=b.criteria;if(a!==b){if(a>b||typeof a=='undefined'){return 1;}
if(a<b||typeof b=='undefined'){return-1;}}
return ai<bi?-1:1;}
function createCache(array){var index=-1,length=array.length;var cache=getObject();cache['false']=cache['null']=cache['true']=cache['undefined']=false;var result=getObject();result.array=array;result.cache=cache;result.push=cachePush;while(++index<length){result.push(array[index]);}
return cache.object===false?(releaseObject(result),null):result;}
function escapeStringChar(match){return'\\'+stringEscapes[match];}
function getArray(){return arrayPool.pop()||[];}
function getObject(){return objectPool.pop()||{'array':null,'cache':null,'criteria':null,'false':false,'index':0,'leading':false,'maxWait':0,'null':false,'number':null,'object':null,'push':null,'string':null,'trailing':false,'true':false,'undefined':false,'value':null};}
function noop(){}
function releaseArray(array){array.length=0;if(arrayPool.length<maxPoolSize){arrayPool.push(array);}}
function releaseObject(object){var cache=object.cache;if(cache){releaseObject(cache);}
object.array=object.cache=object.criteria=object.object=object.number=object.string=object.value=null;if(objectPool.length<maxPoolSize){objectPool.push(object);}}
function slice(array,start,end){start||(start=0);if(typeof end=='undefined'){end=array?array.length:0;}
var index=-1,length=end-start||0,result=Array(length<0?0:length);while(++index<length){result[index]=array[start+index];}
return result;}
function runInContext(context){context=context?_.defaults(window.Object(),context,_.pick(window,contextProps)):window;var Array=context.Array,Boolean=context.Boolean,Date=context.Date,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayRef=[];var objectProto=Object.prototype,stringProto=String.prototype;var oldDash=context._;var reNative=RegExp('^'+
String(objectProto.valueOf).replace(/[.*+?^${}()|[\]\\]/g,'\\$&').replace(/valueOf|for [^\]]+/g,'.+?')+'$');var ceil=Math.ceil,clearTimeout=context.clearTimeout,concat=arrayRef.concat,floor=Math.floor,fnToString=Function.prototype.toString,getPrototypeOf=reNative.test(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,setImmediate=context.setImmediate,setTimeout=context.setTimeout,toString=objectProto.toString;var nativeBind=reNative.test(nativeBind=toString.bind)&&nativeBind,nativeCreate=reNative.test(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=reNative.test(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=context.isFinite,nativeIsNaN=context.isNaN,nativeKeys=reNative.test(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeSlice=arrayRef.slice;var isIeOpera=reNative.test(context.attachEvent),isV8=nativeBind&&!/\n|true/.test(nativeBind+isIeOpera);var ctorByClass={};ctorByClass[arrayClass]=Array;ctorByClass[boolClass]=Boolean;ctorByClass[dateClass]=Date;ctorByClass[funcClass]=Function;ctorByClass[objectClass]=Object;ctorByClass[numberClass]=Number;ctorByClass[regexpClass]=RegExp;ctorByClass[stringClass]=String;function lodash(value){return(value&&typeof value=='object'&&!isArray(value)&&hasOwnProperty.call(value,'__wrapped__'))?value:new lodashWrapper(value);}
function lodashWrapper(value){this.__wrapped__=value;}
lodashWrapper.prototype=lodash.prototype;var support=lodash.support={};support.fastBind=nativeBind&&!isV8;lodash.templateSettings={'escape':/<%-([\s\S]+?)%>/g,'evaluate':/<%([\s\S]+?)%>/g,'interpolate':reInterpolate,'variable':'','imports':{'_':lodash}};function createBound(func,thisArg,partialArgs,indicator){var isFunc=isFunction(func),isPartial=!partialArgs,key=thisArg;if(isPartial){var rightIndicator=indicator;partialArgs=thisArg;}
else if(!isFunc){if(!indicator){throw new TypeError;}
thisArg=func;}
function bound(){var args=arguments,thisBinding=isPartial?this:thisArg;if(!isFunc){func=thisArg[key];}
if(partialArgs.length){args=args.length?(args=nativeSlice.call(args),rightIndicator?args.concat(partialArgs):partialArgs.concat(args)):partialArgs;}
if(this instanceof bound){thisBinding=createObject(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding;}
return func.apply(thisBinding,args);}
return bound;}
function createObject(prototype){return isObject(prototype)?nativeCreate(prototype):{};}
function escapeHtmlChar(match){return htmlEscapes[match];}
function getIndexOf(array,value,fromIndex){var result=(result=lodash.indexOf)===indexOf?basicIndexOf:result;return result;}
function overloadWrapper(func){return function(array,flag,callback,thisArg){if(typeof flag!='boolean'&&flag!=null){thisArg=callback;callback=!(thisArg&&thisArg[flag]===array)?flag:undefined;flag=false;}
if(callback!=null){callback=lodash.createCallback(callback,thisArg);}
return func(array,flag,callback,thisArg);};}
function shimIsPlainObject(value){var ctor,result;if(!(value&&toString.call(value)==objectClass)||(ctor=value.constructor,isFunction(ctor)&&!(ctor instanceof ctor))){return false;}
forIn(value,function(value,key){result=key;});return result===undefined||hasOwnProperty.call(value,result);}
function unescapeHtmlChar(match){return htmlUnescapes[match];}
function isArguments(value){return toString.call(value)==argsClass;}
var isArray=nativeIsArray;var shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!(objectTypes[typeof object]))return result;for(index in iterable){if(hasOwnProperty.call(iterable,index)){result.push(index);}}
return result};var keys=!nativeKeys?shimKeys:function(object){if(!isObject(object)){return[];}
return nativeKeys(object);};var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};var htmlUnescapes=invert(htmlEscapes);var assign=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=='number'?2:args.length;if(argsLength>3&&typeof args[argsLength-2]=='function'){var callback=lodash.createCallback(args[--argsLength-1],args[argsLength--],2);}else if(argsLength>2&&typeof args[argsLength-1]=='function'){callback=args[--argsLength];}
while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];result[index]=callback?callback(result[index],iterable[index]):iterable[index];}}}
return result};function clone(value,deep,callback,thisArg,stackA,stackB){var result=value;if(typeof deep!='boolean'&&deep!=null){thisArg=callback;callback=deep;deep=false;}
if(typeof callback=='function'){callback=(typeof thisArg=='undefined')?callback:lodash.createCallback(callback,thisArg,1);result=callback(result);if(typeof result!='undefined'){return result;}
result=value;}
var isObj=isObject(result);if(isObj){var className=toString.call(result);if(!cloneableClasses[className]){return result;}
var isArr=isArray(result);}
if(!isObj||!deep){return isObj?(isArr?slice(result):assign({},result)):result;}
var ctor=ctorByClass[className];switch(className){case boolClass:case dateClass:return new ctor(+result);case numberClass:case stringClass:return new ctor(result);case regexpClass:return ctor(result.source,reFlags.exec(result));}
var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length];}}
result=isArr?ctor(result.length):{};if(isArr){if(hasOwnProperty.call(value,'index')){result.index=value.index;}
if(hasOwnProperty.call(value,'input')){result.input=value.input;}}
stackA.push(value);stackB.push(result);(isArr?forEach:forOwn)(value,function(objValue,key){result[key]=clone(objValue,deep,callback,undefined,stackA,stackB);});if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function cloneDeep(value,callback,thisArg){return clone(value,true,callback,thisArg);}
var defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=='number'?2:args.length;while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];if(typeof result[index]=='undefined')result[index]=iterable[index];}}}
return result};function findKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg);forOwn(object,function(value,key,object){if(callback(value,key,object)){result=key;return false;}});return result;}
var forIn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=='undefined'?callback:lodash.createCallback(callback,thisArg);for(index in iterable){if(callback(iterable[index],index,collection)===false)return result;}
return result};var forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=='undefined'?callback:lodash.createCallback(callback,thisArg);var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];if(callback(iterable[index],index,collection)===false)return result;}
return result};function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key);}});return result.sort();}
function has(object,property){return object?hasOwnProperty.call(object,property):false;}
function invert(object){var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index];result[object[key]]=key;}
return result;}
function isBoolean(value){return value===true||value===false||toString.call(value)==boolClass;}
function isDate(value){return value?(typeof value=='object'&&toString.call(value)==dateClass):false;}
function isElement(value){return value?value.nodeType===1:false;}
function isEmpty(value){var result=true;if(!value){return result;}
var className=toString.call(value),length=value.length;if((className==arrayClass||className==stringClass||className==argsClass)||(className==objectClass&&typeof length=='number'&&isFunction(value.splice))){return!length;}
forOwn(value,function(){return(result=false);});return result;}
function isEqual(a,b,callback,thisArg,stackA,stackB){var whereIndicator=callback===indicatorObject;if(typeof callback=='function'&&!whereIndicator){callback=lodash.createCallback(callback,thisArg,2);var result=callback(a,b);if(typeof result!='undefined'){return!!result;}}
if(a===b){return a!==0||(1/a==1/b);}
var type=typeof a,otherType=typeof b;if(a===a&&(!a||(type!='function'&&type!='object'))&&(!b||(otherType!='function'&&otherType!='object'))){return false;}
if(a==null||b==null){return a===b;}
var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass;}
if(otherClass==argsClass){otherClass=objectClass;}
if(className!=otherClass){return false;}
switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return(a!=+a)?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==String(b);}
var isArr=className==arrayClass;if(!isArr){if(hasOwnProperty.call(a,'__wrapped__ ')||hasOwnProperty.call(b,'__wrapped__')){return isEqual(a.__wrapped__||a,b.__wrapped__||b,callback,thisArg,stackA,stackB);}
if(className!=objectClass){return false;}
var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)){return false;}}
var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b;}}
var size=0;result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==a.length;if(!result&&!whereIndicator){return result;}
while(size--){var index=length,value=b[size];if(whereIndicator){while(index--){if((result=isEqual(a[index],value,callback,thisArg,stackA,stackB))){break;}}}else if(!(result=isEqual(a[size],value,callback,thisArg,stackA,stackB))){break;}}
return result;}
forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return(result=hasOwnProperty.call(a,key)&&isEqual(a[key],value,callback,thisArg,stackA,stackB));}});if(result&&!whereIndicator){forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return(result=--size>-1);}});}
if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value));}
function isFunction(value){return typeof value=='function';}
function isObject(value){return!!(value&&objectTypes[typeof value]);}
function isNaN(value){return isNumber(value)&&value!=+value}
function isNull(value){return value===null;}
function isNumber(value){return typeof value=='number'||toString.call(value)==numberClass;}
var isPlainObject=function(value){if(!(value&&toString.call(value)==objectClass)){return false;}
var valueOf=value.valueOf,objProto=typeof valueOf=='function'&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?(value==objProto||getPrototypeOf(value)==objProto):shimIsPlainObject(value);};function isRegExp(value){return value?(typeof value=='object'&&toString.call(value)==regexpClass):false;}
function isString(value){return typeof value=='string'||toString.call(value)==stringClass;}
function isUndefined(value){return typeof value=='undefined';}
function merge(object,source,deepIndicator){var args=arguments,index=0,length=2;if(!isObject(object)){return object;}
if(deepIndicator===indicatorObject){var callback=args[3],stackA=args[4],stackB=args[5];}else{var initedStack=true;stackA=getArray();stackB=getArray();if(typeof deepIndicator!='number'){length=args.length;}
if(length>3&&typeof args[length-2]=='function'){callback=lodash.createCallback(args[--length-1],args[length--],2);}else if(length>2&&typeof args[length-1]=='function'){callback=args[--length];}}
while(++index<length){(isArray(args[index])?forEach:forOwn)(args[index],function(source,key){var found,isArr,result=source,value=object[key];if(source&&((isArr=isArray(source))||isPlainObject(source))){var stackLength=stackA.length;while(stackLength--){if((found=stackA[stackLength]==source)){value=stackB[stackLength];break;}}
if(!found){var isShallow;if(callback){result=callback(value,source);if((isShallow=typeof result!='undefined')){value=result;}}
if(!isShallow){value=isArr?(isArray(value)?value:[]):(isPlainObject(value)?value:{});}
stackA.push(source);stackB.push(value);if(!isShallow){value=merge(value,source,indicatorObject,callback,stackA,stackB);}}}
else{if(callback){result=callback(value,source);if(typeof result=='undefined'){result=source;}}
if(typeof result!='undefined'){value=result;}}
object[key]=value;});}
if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return object;}
function omit(object,callback,thisArg){var indexOf=getIndexOf(),isFunc=typeof callback=='function',result={};if(isFunc){callback=lodash.createCallback(callback,thisArg);}else{var props=concat.apply(arrayRef,nativeSlice.call(arguments,1));}
forIn(object,function(value,key,object){if(isFunc?!callback(value,key,object):indexOf(props,key)<0){result[key]=value;}});return result;}
function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]];}
return result;}
function pick(object,callback,thisArg){var result={};if(typeof callback!='function'){var index=-1,props=concat.apply(arrayRef,nativeSlice.call(arguments,1)),length=isObject(object)?props.length:0;while(++index<length){var key=props[index];if(key in object){result[key]=object[key];}}}else{callback=lodash.createCallback(callback,thisArg);forIn(object,function(value,key,object){if(callback(value,key,object)){result[key]=value;}});}
return result;}
function transform(object,callback,accumulator,thisArg){var isArr=isArray(object);callback=lodash.createCallback(callback,thisArg,4);if(accumulator==null){if(isArr){accumulator=[];}else{var ctor=object&&object.constructor,proto=ctor&&ctor.prototype;accumulator=createObject(proto);}}
(isArr?forEach:forOwn)(object,function(value,index,object){return callback(accumulator,value,index,object);});return accumulator;}
function values(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]];}
return result;}
function at(collection){var index=-1,props=concat.apply(arrayRef,nativeSlice.call(arguments,1)),length=props.length,result=Array(length);while(++index<length){result[index]=collection[props[index]];}
return result;}
function contains(collection,target,fromIndex){var index=-1,indexOf=getIndexOf(),length=collection?collection.length:0,result=false;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex)||0;if(length&&typeof length=='number'){result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1;}else{forOwn(collection,function(value){if(++index>=fromIndex){return!(result=value===target);}});}
return result;}
function countBy(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=String(callback(value,key,collection));(hasOwnProperty.call(result,key)?result[key]++:result[key]=1);});return result;}
function every(collection,callback,thisArg){var result=true;callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if(!(result=!!callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return(result=!!callback(value,index,collection));});}
return result;}
function filter(collection,callback,thisArg){var result=[];callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){result.push(value);}}}else{forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value);}});}
return result;}
function find(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){return value;}}}else{var result;forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false;}});return result;}}
function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=callback&&typeof thisArg=='undefined'?callback:lodash.createCallback(callback,thisArg);if(typeof length=='number'){while(++index<length){if(callback(collection[index],index,collection)===false){break;}}}else{forOwn(collection,callback);}
return collection;}
function groupBy(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=String(callback(value,key,collection));(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value);});return result;}
function invoke(collection,methodName){var args=nativeSlice.call(arguments,2),index=-1,isFunc=typeof methodName=='function',length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args);});return result;}
function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=lodash.createCallback(callback,thisArg);if(typeof length=='number'){var result=Array(length);while(++index<length){result[index]=callback(collection[index],index,collection);}}else{result=[];forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection);});}
return result;}
function max(collection,callback,thisArg){var computed=-Infinity,result=computed;if(!callback&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value>result){result=value;}}}else{callback=(!callback&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value;}});}
return result;}
function min(collection,callback,thisArg){var computed=Infinity,result=computed;if(!callback&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value<result){result=value;}}}else{callback=(!callback&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value;}});}
return result;}
function pluck(collection,property){var index=-1,length=collection?collection.length:0;if(typeof length=='number'){var result=Array(length);while(++index<length){result[index]=collection[index][property];}}
return result||map(collection,property);}
function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);var index=-1,length=collection.length;if(typeof length=='number'){if(noaccum){accumulator=collection[++index];}
while(++index<length){accumulator=callback(accumulator,collection[index],index,collection);}}else{forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)});}
return accumulator;}
function reduceRight(collection,callback,accumulator,thisArg){var iterable=collection,length=collection?collection.length:0,noaccum=arguments.length<3;if(typeof length!='number'){var props=keys(collection);length=props.length;}
callback=lodash.createCallback(callback,thisArg,4);forEach(collection,function(value,index,collection){index=props?props[--length]:--length;accumulator=noaccum?(noaccum=false,iterable[index]):callback(accumulator,iterable[index],index,collection);});return accumulator;}
function reject(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg);return filter(collection,function(value,index,collection){return!callback(value,index,collection);});}
function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){var rand=floor(nativeRandom()*(++index+1));result[index]=result[rand];result[rand]=value;});return result;}
function size(collection){var length=collection?collection.length:0;return typeof length=='number'?length:keys(collection).length;}
function some(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if((result=callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return!(result=callback(value,index,collection));});}
return!!result;}
function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){var object=result[++index]=getObject();object.criteria=callback(value,key,collection);object.index=index;object.value=value;});length=result.length;result.sort(compareAscending);while(length--){var object=result[length];result[length]=object.value;releaseObject(object);}
return result;}
function toArray(collection){if(collection&&typeof collection.length=='number'){return slice(collection);}
return values(collection);}
var where=filter;function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value);}}
return result;}
function difference(array){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,seen=concat.apply(arrayRef,nativeSlice.call(arguments,1)),result=[];var isLarge=length>=largeArraySize&&indexOf===basicIndexOf;if(isLarge){var cache=createCache(seen);if(cache){indexOf=cacheIndexOf;seen=cache;}else{isLarge=false;}}
while(++index<length){var value=array[index];if(indexOf(seen,value)<0){result.push(value);}}
if(isLarge){releaseObject(seen);}
return result;}
function findIndex(array,callback,thisArg){var index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg);while(++index<length){if(callback(array[index],index,array)){return index;}}
return-1;}
function first(array,callback,thisArg){if(array){var n=0,length=array.length;if(typeof callback!='number'&&callback!=null){var index=-1;callback=lodash.createCallback(callback,thisArg);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array[0];}}
return slice(array,0,nativeMin(nativeMax(0,n),length));}}
var flatten=overloadWrapper(function flatten(array,isShallow,callback){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(callback){value=callback(value,index,array);}
if(isArray(value)){push.apply(result,isShallow?value:flatten(value));}else{result.push(value);}}
return result;});function indexOf(array,value,fromIndex){if(typeof fromIndex=='number'){var length=array?array.length:0;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0);}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1;}
return array?basicIndexOf(array,value,fromIndex):-1;}
function initial(array,callback,thisArg){if(!array){return[];}
var n=0,length=array.length;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg);while(index--&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:callback||n;}
return slice(array,0,nativeMin(nativeMax(0,length-n),length));}
function intersection(array){var args=arguments,argsLength=args.length,argsIndex=-1,caches=getArray(),index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=getArray();while(++argsIndex<argsLength){var value=args[argsIndex];caches[argsIndex]=indexOf===basicIndexOf&&(value?value.length:0)>=largeArraySize&&createCache(argsIndex?args[argsIndex]:seen);}
outer:while(++index<length){var cache=caches[0];value=array[index];if((cache?cacheIndexOf(cache,value):indexOf(seen,value))<0){argsIndex=argsLength;(cache||seen).push(value);while(--argsIndex){cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value))<0){continue outer;}}
result.push(value);}}
while(argsLength--){cache=caches[argsLength];if(cache){releaseObject(cache);}}
releaseArray(caches);releaseArray(seen);return result;}
function last(array,callback,thisArg){if(array){var n=0,length=array.length;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg);while(index--&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array[length-1];}}
return slice(array,nativeMax(0,length-n));}}
function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1;}
while(index--){if(array[index]===value){return index;}}
return-1;}
function range(start,end,step){start=+start||0;step=+step||1;if(end==null){end=start;start=0;}
var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);while(++index<length){result[index]=start;start+=step;}
return result;}
function rest(array,callback,thisArg){if(typeof callback!='number'&&callback!=null){var n=0,index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:nativeMax(0,callback);}
return slice(array,n);}
function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?lodash.createCallback(callback,thisArg,1):identity;value=callback(value);while(low<high){var mid=(low+high)>>>1;(callback(array[mid])<value)?low=mid+1:high=mid;}
return low;}
function union(array){if(!isArray(array)){arguments[0]=array?nativeSlice.call(array):arrayRef;}
return uniq(concat.apply(arrayRef,arguments));}
var uniq=overloadWrapper(function(array,isSorted,callback){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];var isLarge=!isSorted&&length>=largeArraySize&&indexOf===basicIndexOf,seen=(callback||isLarge)?getArray():result;if(isLarge){var cache=createCache(seen);if(cache){indexOf=cacheIndexOf;seen=cache;}else{isLarge=false;seen=callback?seen:(releaseArray(seen),result);}}
while(++index<length){var value=array[index],computed=callback?callback(value,index,array):value;if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){if(callback||isLarge){seen.push(computed);}
result.push(value);}}
if(isLarge){releaseArray(seen.array);releaseObject(seen);}else if(callback){releaseArray(seen);}
return result;});function unzip(array){var index=-1,length=array?max(pluck(array,'length')):0,result=Array(length<0?0:length);while(++index<length){result[index]=pluck(array,index);}
return result;}
function without(array){return difference(array,nativeSlice.call(arguments,1));}
function zip(array){return array?unzip(arguments):[];}
function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};while(++index<length){var key=keys[index];if(values){result[key]=values[index];}else{result[key[0]]=key[1];}}
return result;}
function after(n,func){if(n<1){return func();}
return function(){if(--n<1){return func.apply(this,arguments);}};}
function bind(func,thisArg){return support.fastBind||(nativeBind&&arguments.length>2)?nativeBind.call.apply(nativeBind,arguments):createBound(func,thisArg,nativeSlice.call(arguments,2));}
function bindAll(object){var funcs=arguments.length>1?concat.apply(arrayRef,nativeSlice.call(arguments,1)):functions(object),index=-1,length=funcs.length;while(++index<length){var key=funcs[index];object[key]=bind(object[key],object);}
return object;}
function bindKey(object,key){return createBound(object,key,nativeSlice.call(arguments,2),indicatorObject);}
function compose(){var funcs=arguments;return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)];}
return args[0];};}
function createCallback(func,thisArg,argCount){if(func==null){return identity;}
var type=typeof func;if(type!='function'){if(type!='object'){return function(object){return object[func];};}
var props=keys(func);return function(object){var length=props.length,result=false;while(length--){if(!(result=isEqual(object[props[length]],func[props[length]],indicatorObject))){break;}}
return result;};}
if(typeof thisArg=='undefined'||(reThis&&!reThis.test(fnToString.call(func)))){return func;}
if(argCount===1){return function(value){return func.call(thisArg,value);};}
if(argCount===2){return function(a,b){return func.call(thisArg,a,b);};}
if(argCount===4){return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};}
return function(value,index,collection){return func.call(thisArg,value,index,collection);};}
function debounce(func,wait,options){var args,result,thisArg,callCount=0,lastCalled=0,maxWait=false,maxTimeoutId=null,timeoutId=null,trailing=true;function clear(){clearTimeout(maxTimeoutId);clearTimeout(timeoutId);callCount=0;maxTimeoutId=timeoutId=null;}
function delayed(){var isCalled=trailing&&(!leading||callCount>1);clear();if(isCalled){if(maxWait!==false){lastCalled=new Date;}
result=func.apply(thisArg,args);}}
function maxDelayed(){clear();if(trailing||(maxWait!==wait)){lastCalled=new Date;result=func.apply(thisArg,args);}}
wait=nativeMax(0,wait||0);if(options===true){var leading=true;trailing=false;}else if(isObject(options)){leading=options.leading;maxWait='maxWait'in options&&nativeMax(wait,options.maxWait||0);trailing='trailing'in options?options.trailing:trailing;}
return function(){args=arguments;thisArg=this;callCount++;clearTimeout(timeoutId);if(maxWait===false){if(leading&&callCount<2){result=func.apply(thisArg,args);}}else{var now=new Date;if(!maxTimeoutId&&!leading){lastCalled=now;}
var remaining=maxWait-(now-lastCalled);if(remaining<=0){clearTimeout(maxTimeoutId);maxTimeoutId=null;lastCalled=now;result=func.apply(thisArg,args);}
else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}
if(wait!==maxWait){timeoutId=setTimeout(delayed,wait);}
return result;};}
function defer(func){var args=nativeSlice.call(arguments,1);return setTimeout(function(){func.apply(undefined,args);},1);}
if(isV8&&freeModule&&typeof setImmediate=='function'){defer=bind(setImmediate,context);}
function delay(func,wait){var args=nativeSlice.call(arguments,2);return setTimeout(function(){func.apply(undefined,args);},wait);}
function memoize(func,resolver){function memoized(){var cache=memoized.cache,key=keyPrefix+(resolver?resolver.apply(this,arguments):arguments[0]);return hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=func.apply(this,arguments));}
memoized.cache={};return memoized;}
function once(func){var ran,result;return function(){if(ran){return result;}
ran=true;result=func.apply(this,arguments);func=null;return result;};}
function partial(func){return createBound(func,nativeSlice.call(arguments,1));}
function partialRight(func){return createBound(func,nativeSlice.call(arguments,1),null,indicatorObject);}
function throttle(func,wait,options){var leading=true,trailing=true;if(options===false){leading=false;}else if(isObject(options)){leading='leading'in options?options.leading:leading;trailing='trailing'in options?options.trailing:trailing;}
options=getObject();options.leading=leading;options.maxWait=wait;options.trailing=trailing;var result=debounce(func,wait,options);releaseObject(options);return result;}
function wrap(value,wrapper){return function(){var args=[value];push.apply(args,arguments);return wrapper.apply(this,args);};}
function escape(string){return string==null?'':String(string).replace(reUnescapedHtml,escapeHtmlChar);}
function identity(value){return value;}
function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=[value];push.apply(args,arguments);var result=func.apply(lodash,args);return(value&&typeof value=='object'&&value===result)?this:new lodashWrapper(result);};});}
function noConflict(){context._=oldDash;return this;}
var parseInt=nativeParseInt(whitespace+'08')==8?nativeParseInt:function(value,radix){return nativeParseInt(isString(value)?value.replace(reLeadingSpacesAndZeros,''):value,radix||0);};function random(min,max){if(min==null&&max==null){max=1;}
min=+min||0;if(max==null){max=min;min=0;}else{max=+max||0;}
var rand=nativeRandom();return(min%1||max%1)?min+nativeMin(rand*(max-min+parseFloat('1e-'+((rand+'').length-1))),max):min+floor(rand*(max-min+1));}
function result(object,property){var value=object?object[property]:undefined;return isFunction(value)?object[property]():value;}
function template(text,data,options){var settings=lodash.templateSettings;text||(text='');options=defaults({},options,settings);var imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports);var isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+
interpolate.source+'|'+
(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+'|'+
(options.evaluate||reNoMatch).source+'|$','g');text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){source+="' +\n__e("+escapeValue+") +\n'";}
if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '";}
if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'";}
index=offset+match.length;return match;});source+="';\n";var variable=options.variable,hasVariable=variable;if(!hasVariable){variable='obj';source='with ('+variable+') {\n'+source+'\n}\n';}
source=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');source='function('+variable+') {\n'+
(hasVariable?'':variable+' || ('+variable+' = {});\n')+"var __t, __p = '', __e = _.escape"+
(isEvaluating?', __j = Array.prototype.join;\n'+"function print() { __p += __j.call(arguments, '') }\n":';\n')+
source+'return __p\n}';var sourceURL='\n/*\n//@ sourceURL='+(options.sourceURL||'/lodash/template/source['+(templateCounter++)+']')+'\n*/';try{var result=Function(importsKeys,'return '+source+sourceURL).apply(undefined,importsValues);}catch(e){e.source=source;throw e;}
if(data){return result(data);}
result.source=source;return result;}
function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=lodash.createCallback(callback,thisArg,1);while(++index<n){result[index]=callback(index);}
return result;}
function unescape(string){return string==null?'':String(string).replace(reEscapedHtml,unescapeHtmlChar);}
function uniqueId(prefix){var id=++idCounter;return String(prefix==null?'':prefix)+id;}
function tap(value,interceptor){interceptor(value);return value;}
function wrapperToString(){return String(this.__wrapped__);}
function wrapperValueOf(){return this.__wrapped__;}
lodash.after=after;lodash.assign=assign;lodash.at=at;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.compact=compact;lodash.compose=compose;lodash.countBy=countBy;lodash.createCallback=createCallback;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.forIn=forIn;lodash.forOwn=forOwn;lodash.functions=functions;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.max=max;lodash.memoize=memoize;lodash.merge=merge;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.pick=pick;lodash.pluck=pluck;lodash.range=range;lodash.reject=reject;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.zip=zip;lodash.zipObject=zipObject;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash);lodash.chain=lodash;lodash.prototype.chain=function(){return this;};lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.findWhere=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);return func.apply(lodash,args);};}});lodash.first=first;lodash.last=last;lodash.take=first;lodash.head=first;forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(callback,thisArg){var result=func(this.__wrapped__,callback,thisArg);return callback==null||(thisArg&&typeof callback!='function')?result:new lodashWrapper(result);};}});lodash.VERSION='1.3.1';lodash.prototype.toString=wrapperToString;lodash.prototype.value=wrapperValueOf;lodash.prototype.valueOf=wrapperValueOf;forEach(['join','pop','shift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return func.apply(this.__wrapped__,arguments);};});forEach(['push','reverse','sort','unshift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){func.apply(this.__wrapped__,arguments);return this;};});forEach(['concat','slice','splice'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return new lodashWrapper(func.apply(this.__wrapped__,arguments));};});return lodash;}
var _=runInContext();if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){window._=_;define(function(){return _;});}
else if(freeExports&&!freeExports.nodeType){if(freeModule){(freeModule.exports=_)._=_;}
else{freeExports._=_;}}
else{window._=_;}}(this));
(function(definition){if(typeof bootstrap==="function"){bootstrap("promise",definition);}else if(typeof exports==="object"){module.exports=definition();}else if(typeof define==="function"&&define.amd){define(definition);}else if(typeof ses!=="undefined"){if(!ses.ok()){return;}else{ses.makeQ=definition;}}else{Q=definition();}})(function(){"use strict";var hasStacks=false;try{throw new Error();}catch(e){hasStacks=!!e.stack;}
var qStartingLine=captureLine();var qFileName;var noop=function(){};var nextTick=(function(){var head={task:void 0,next:null};var tail=head;var flushing=false;var requestTick=void 0;var isNodeJS=false;function flush(){while(head.next){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;if(domain){head.domain=void 0;domain.enter();}
try{task();}catch(e){if(isNodeJS){if(domain){domain.exit();}
setTimeout(flush,0);if(domain){domain.enter();}
throw e;}else{setTimeout(function(){throw e;},0);}}
if(domain){domain.exit();}}
flushing=false;}
nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null};if(!flushing){flushing=true;requestTick();}};if(typeof process!=="undefined"&&process.nextTick){isNodeJS=true;requestTick=function(){process.nextTick(flush);};}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){requestTick=setImmediate.bind(window,flush);}else{requestTick=function(){setImmediate(flush);};}}else if(typeof MessageChannel!=="undefined"){var channel=new MessageChannel();channel.port1.onmessage=function(){requestTick=requestPortTick;channel.port1.onmessage=flush;flush();};var requestPortTick=function(){channel.port2.postMessage(0);};requestTick=function(){setTimeout(flush,0);requestPortTick();};}else{requestTick=function(){setTimeout(flush,0);};}
return nextTick;})();var call=Function.call;function uncurryThis(f){return function(){return call.apply(f,arguments);};}
var array_slice=uncurryThis(Array.prototype.slice);var array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(arguments.length===1){do{if(index in this){basis=this[index++];break;}
if(++index>=length){throw new TypeError();}}while(1);}
for(;index<length;index++){if(index in this){basis=callback(basis,this[index],index);}}
return basis;});var array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++){if(this[i]===value){return i;}}
return-1;});var array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this;var collect=[];array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self));},void 0);return collect;});var object_create=Object.create||function(prototype){function Type(){}
Type.prototype=prototype;return new Type();};var object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty);var object_keys=Object.keys||function(object){var keys=[];for(var key in object){if(object_hasOwnProperty(object,key)){keys.push(key);}}
return keys;};var object_toString=uncurryThis(Object.prototype.toString);function isObject(value){return value===Object(value);}
function isStopIteration(exception){return(object_toString(exception)==="[object StopIteration]"||exception instanceof QReturnValue);}
var QReturnValue;if(typeof ReturnValue!=="undefined"){QReturnValue=ReturnValue;}else{QReturnValue=function(value){this.value=value;};}
var hasES6Generators;try{new Function("(function* (){ yield 1; })");hasES6Generators=true;}catch(e){hasES6Generators=false;}
var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var p=promise;!!p;p=p.source){if(p.stack){stacks.unshift(p.stack);}}
stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks);}}
function filterStackString(stackString){var lines=stackString.split("\n");var desiredLines=[];for(var i=0;i<lines.length;++i){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line);}}
return desiredLines.join("\n");}
function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1;}
function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])];}
var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])];}
var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])];}}
function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false;}
var fileName=fileNameAndLineNumber[0];var lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&lineNumber<=qEndingLine;}
function captureLine(){if(!hasStacks){return;}
try{throw new Error();}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return;}
qFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1];}}
function deprecate(callback,name,alternative){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack);}
return callback.apply(callback,arguments);};}
function Q(value){if(isPromise(value)){return value;}
if(isPromiseAlike(value)){return coerce(value);}else{return fulfill(value);}}
Q.resolve=Q;Q.nextTick=nextTick;Q.longStackSupport=false;Q.defer=defer;function defer(){var messages=[],progressListeners=[],resolvedPromise;var deferred=object_create(defer.prototype);var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);if(messages){messages.push(args);if(op==="when"&&operands[1]){progressListeners.push(operands[1]);}}else{nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args);});}};promise.valueOf=deprecate(function(){if(messages){return promise;}
var nearerValue=nearer(resolvedPromise);if(isPromise(nearerValue)){resolvedPromise=nearerValue;}
return nearerValue;},"valueOf","inspect");promise.inspect=function(){if(!resolvedPromise){return{state:"pending"};}
return resolvedPromise.inspect();};if(Q.longStackSupport&&hasStacks){try{throw new Error();}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1);}}
function become(newPromise){resolvedPromise=newPromise;promise.source=newPromise;array_reduce(messages,function(undefined,message){nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message);});},void 0);messages=void 0;progressListeners=void 0;}
deferred.promise=promise;deferred.resolve=function(value){if(resolvedPromise){return;}
become(Q(value));};deferred.fulfill=function(value){if(resolvedPromise){return;}
become(fulfill(value));};deferred.reject=function(reason){if(resolvedPromise){return;}
become(reject(reason));};deferred.notify=function(progress){if(resolvedPromise){return;}
array_reduce(progressListeners,function(undefined,progressListener){nextTick(function(){progressListener(progress);});},void 0);};return deferred;}
defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){if(error){self.reject(error);}else if(arguments.length>2){self.resolve(array_slice(arguments,1));}else{self.resolve(value);}};};Q.promise=promise;function promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function.");}
var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify);}catch(reason){deferred.reject(reason);}
return deferred.promise;}
Q.passByCopy=function(object){return object;};Promise.prototype.passByCopy=function(){return this;};Q.join=function(x,y){return Q(x).join(y);};Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y){return x;}else{throw new Error("Can't join: not the same: "+x+" "+y);}});};Q.race=race;function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;i<len;i++){Q(answerPs[i]).then(resolve,reject);}});}
Promise.prototype.race=function(){return this.then(Q.race);};Q.makePromise=Promise;function Promise(descriptor,fallback,inspect){if(fallback===void 0){fallback=function(op){return reject(new Error("Promise does not support operation: "+op));};}
if(inspect===void 0){inspect=function(){return{state:"unknown"};};}
var promise=object_create(Promise.prototype);promise.promiseDispatch=function(resolve,op,args){var result;try{if(descriptor[op]){result=descriptor[op].apply(promise,args);}else{result=fallback.call(promise,op,args);}}catch(exception){result=reject(exception);}
if(resolve){resolve(result);}};promise.inspect=inspect;if(inspect){var inspected=inspect();if(inspected.state==="rejected"){promise.exception=inspected.reason;}
promise.valueOf=deprecate(function(){var inspected=inspect();if(inspected.state==="pending"||inspected.state==="rejected"){return promise;}
return inspected.value;});}
return promise;}
Promise.prototype.toString=function(){return"[object Promise]";};Promise.prototype.then=function(fulfilled,rejected,progressed){var self=this;var deferred=defer();var done=false;function _fulfilled(value){try{return typeof fulfilled==="function"?fulfilled(value):value;}catch(exception){return reject(exception);}}
function _rejected(exception){if(typeof rejected==="function"){makeStackTraceLong(exception,self);try{return rejected(exception);}catch(newException){return reject(newException);}}
return reject(exception);}
function _progressed(value){return typeof progressed==="function"?progressed(value):value;}
nextTick(function(){self.promiseDispatch(function(value){if(done){return;}
done=true;deferred.resolve(_fulfilled(value));},"when",[function(exception){if(done){return;}
done=true;deferred.resolve(_rejected(exception));}]);});self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue;var threw=false;try{newValue=_progressed(value);}catch(e){threw=true;if(Q.onerror){Q.onerror(e);}else{throw e;}}
if(!threw){deferred.notify(newValue);}}]);return deferred.promise;};Q.when=when;function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed);}
Promise.prototype.thenResolve=function(value){return this.then(function(){return value;});};Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value);};Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason;});};Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason);};Q.nearer=nearer;function nearer(value){if(isPromise(value)){var inspected=value.inspect();if(inspected.state==="fulfilled"){return inspected.value;}}
return value;}
Q.isPromise=isPromise;function isPromise(object){return isObject(object)&&typeof object.promiseDispatch==="function"&&typeof object.inspect==="function";}
Q.isPromiseAlike=isPromiseAlike;function isPromiseAlike(object){return isObject(object)&&typeof object.then==="function";}
Q.isPending=isPending;function isPending(object){return isPromise(object)&&object.inspect().state==="pending";}
Promise.prototype.isPending=function(){return this.inspect().state==="pending";};Q.isFulfilled=isFulfilled;function isFulfilled(object){return!isPromise(object)||object.inspect().state==="fulfilled";}
Promise.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled";};Q.isRejected=isRejected;function isRejected(object){return isPromise(object)&&object.inspect().state==="rejected";}
Promise.prototype.isRejected=function(){return this.inspect().state==="rejected";};var unhandledReasons=[];var unhandledRejections=[];var unhandledReasonsDisplayed=false;var trackUnhandledRejections=true;function displayUnhandledReasons(){if(!unhandledReasonsDisplayed&&typeof window!=="undefined"&&!window.Touch&&window.console){console.warn("[Q] Unhandled rejection reasons (should be empty):",unhandledReasons);}
unhandledReasonsDisplayed=true;}
function logUnhandledReasons(){for(var i=0;i<unhandledReasons.length;i++){var reason=unhandledReasons[i];console.warn("Unhandled rejection reason:",reason);}}
function resetUnhandledRejections(){unhandledReasons.length=0;unhandledRejections.length=0;unhandledReasonsDisplayed=false;if(!trackUnhandledRejections){trackUnhandledRejections=true;if(typeof process!=="undefined"&&process.on){process.on("exit",logUnhandledReasons);}}}
function trackRejection(promise,reason){if(!trackUnhandledRejections){return;}
unhandledRejections.push(promise);if(reason&&typeof reason.stack!=="undefined"){unhandledReasons.push(reason.stack);}else{unhandledReasons.push("(no stack) "+reason);}
displayUnhandledReasons();}
function untrackRejection(promise){if(!trackUnhandledRejections){return;}
var at=array_indexOf(unhandledRejections,promise);if(at!==-1){unhandledRejections.splice(at,1);unhandledReasons.splice(at,1);}}
Q.resetUnhandledRejections=resetUnhandledRejections;Q.getUnhandledReasons=function(){return unhandledReasons.slice();};Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections();if(typeof process!=="undefined"&&process.on){process.removeListener("exit",logUnhandledReasons);}
trackUnhandledRejections=false;};resetUnhandledRejections();Q.reject=reject;function reject(reason){var rejection=Promise({"when":function(rejected){if(rejected){untrackRejection(this);}
return rejected?rejected(reason):this;}},function fallback(){return this;},function inspect(){return{state:"rejected",reason:reason};});trackRejection(rejection,reason);return rejection;}
Q.fulfill=fulfill;function fulfill(value){return Promise({"when":function(){return value;},"get":function(name){return value[name];},"set":function(name,rhs){value[name]=rhs;},"delete":function(name){delete value[name];},"post":function(name,args){if(name===null||name===void 0){return value.apply(void 0,args);}else{return value[name].apply(value,args);}},"apply":function(thisp,args){return value.apply(thisp,args);},"keys":function(){return object_keys(value);}},void 0,function inspect(){return{state:"fulfilled",value:value};});}
function coerce(promise){var deferred=defer();nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify);}catch(exception){deferred.reject(exception);}});return deferred.promise;}
Q.master=master;function master(object){return Promise({"isDef":function(){}},function fallback(op,args){return dispatch(object,op,args);},function(){return Q(object).inspect();});}
Q.spread=spread;function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected);}
Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array);},rejected);};Q.async=async;function async(makeGenerator){return function(){function continuer(verb,arg){var result;if(hasES6Generators){try{result=generator[verb](arg);}catch(exception){return reject(exception);}
if(result.done){return result.value;}else{return when(result.value,callback,errback);}}else{try{result=generator[verb](arg);}catch(exception){if(isStopIteration(exception)){return exception.value;}else{return reject(exception);}}
return when(result,callback,errback);}}
var generator=makeGenerator.apply(this,arguments);var callback=continuer.bind(continuer,"next");var errback=continuer.bind(continuer,"throw");return callback();};}
Q.spawn=spawn;function spawn(makeGenerator){Q.done(Q.async(makeGenerator)());}
Q["return"]=_return;function _return(value){throw new QReturnValue(value);}
Q.promised=promised;function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args);});};}
Q.dispatch=dispatch;function dispatch(object,op,args){return Q(object).dispatch(op,args);}
Promise.prototype.dispatch=function(op,args){var self=this;var deferred=defer();nextTick(function(){self.promiseDispatch(deferred.resolve,op,args);});return deferred.promise;};Q.get=function(object,key){return Q(object).dispatch("get",[key]);};Promise.prototype.get=function(key){return this.dispatch("get",[key]);};Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value]);};Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value]);};Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key]);};Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key]);};Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args]);};Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args]);};Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)]);};Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)]);};Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args]);};Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args]);};Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)]);};Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)]);};Q.fbind=function(object){var promise=Q(object);var args=array_slice(arguments,1);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))]);};};Promise.prototype.fbind=function(){var promise=this;var args=array_slice(arguments);return function fbound(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))]);};};Q.keys=function(object){return Q(object).dispatch("keys",[]);};Promise.prototype.keys=function(){return this.dispatch("keys",[]);};Q.all=all;function all(promises){return when(promises,function(promises){var countDown=0;var deferred=defer();array_reduce(promises,function(undefined,promise,index){var snapshot;if(isPromise(promise)&&(snapshot=promise.inspect()).state==="fulfilled"){promises[index]=snapshot.value;}else{++countDown;when(promise,function(value){promises[index]=value;if(--countDown===0){deferred.resolve(promises);}},deferred.reject,function(progress){deferred.notify({index:index,value:progress});});}},void 0);if(countDown===0){deferred.resolve(promises);}
return deferred.promise;});}
Promise.prototype.all=function(){return all(this);};Q.allResolved=deprecate(allResolved,"allResolved","allSettled");function allResolved(promises){return when(promises,function(promises){promises=array_map(promises,Q);return when(all(array_map(promises,function(promise){return when(promise,noop,noop);})),function(){return promises;});});}
Promise.prototype.allResolved=function(){return allResolved(this);};Q.allSettled=allSettled;function allSettled(promises){return Q(promises).allSettled();}
Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){promise=Q(promise);function regardless(){return promise.inspect();}
return promise.then(regardless,regardless);}));});};Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected);};Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected);};Q.progress=progress;function progress(object,progressed){return Q(object).then(void 0,void 0,progressed);}
Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed);};Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback);};Promise.prototype.fin=Promise.prototype["finally"]=function(callback){callback=Q(callback);return this.then(function(value){return callback.fcall().then(function(){return value;});},function(reason){return callback.fcall().then(function(){throw reason;});});};Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress);};Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){nextTick(function(){makeStackTraceLong(error,promise);if(Q.onerror){Q.onerror(error);}else{throw error;}});};var promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;if(typeof process==="object"&&process&&process.domain){onUnhandledError=process.domain.bind(onUnhandledError);}
promise.then(void 0,onUnhandledError);};Q.timeout=function(object,ms,message){return Q(object).timeout(ms,message);};Promise.prototype.timeout=function(ms,message){var deferred=defer();var timeoutId=setTimeout(function(){deferred.reject(new Error(message||"Timed out after "+ms+" ms"));},ms);this.then(function(value){clearTimeout(timeoutId);deferred.resolve(value);},function(exception){clearTimeout(timeoutId);deferred.reject(exception);},deferred.notify);return deferred.promise;};Q.delay=function(object,timeout){if(timeout===void 0){timeout=object;object=void 0;}
return Q(object).delay(timeout);};Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();setTimeout(function(){deferred.resolve(value);},timeout);return deferred.promise;});};Q.nfapply=function(callback,args){return Q(callback).nfapply(args);};Promise.prototype.nfapply=function(args){var deferred=defer();var nodeArgs=array_slice(args);nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise;};Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args);};Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.fapply(nodeArgs).fail(deferred.reject);return deferred.promise;};Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(callback).fapply(nodeArgs).fail(deferred.reject);return deferred.promise;};};Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);args.unshift(this);return Q.denodeify.apply(void 0,args);};Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments));var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());function bound(){return callback.apply(thisp,arguments);}
Q(bound).fapply(nodeArgs).fail(deferred.reject);return deferred.promise;};};Promise.prototype.nbind=function(){var args=array_slice(arguments,0);args.unshift(this);return Q.nbind.apply(void 0,args);};Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args);};Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise;};Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise;};Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1);var deferred=defer();nodeArgs.push(deferred.makeNodeResolver());this.dispatch("post",[name,nodeArgs]).fail(deferred.reject);return deferred.promise;};Q.nodeify=nodeify;function nodeify(object,nodeback){return Q(object).nodeify(nodeback);}
Promise.prototype.nodeify=function(nodeback){if(nodeback){this.then(function(value){nextTick(function(){nodeback(null,value);});},function(error){nextTick(function(){nodeback(error);});});}else{return this;}};var qEndingLine=captureLine();return Q;});
(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('./punycode'),require('./IPv6'),require('./SecondLevelDomains'));}else if(typeof define==='function'&&define.amd){define(['./punycode','./IPv6','./SecondLevelDomains'],factory);}else{root.URI=factory(root.punycode,root.IPv6,root.SecondLevelDomains,root);}}(this,function(punycode,IPv6,SLD,root){"use strict";var _URI=root&&root.URI;function URI(url,base){if(!(this instanceof URI)){return new URI(url,base);}
if(url===undefined){if(typeof location!=='undefined'){url=location.href+"";}else{url="";}}
this.href(url);if(base!==undefined){return this.absoluteTo(base);}
return this;};URI.version='[dev-version]';var p=URI.prototype;var hasOwn=Object.prototype.hasOwnProperty;function escapeRegEx(string){return string.replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');}
function getType(value){if(value===undefined){return'Undefined';}
return String(Object.prototype.toString.call(value)).slice(8,-1);}
function isArray(obj){return getType(obj)==="Array";}
function filterArrayValues(data,value){var lookup={};var i,length;if(isArray(value)){for(i=0,length=value.length;i<length;i++){lookup[value[i]]=true;}}else{lookup[value]=true;}
for(i=0,length=data.length;i<length;i++){if(lookup[data[i]]!==undefined){data.splice(i,1);length--;i--;}}
return data;}
function arrayContains(list,value){var i,length;if(isArray(value)){for(i=0,length=value.length;i<length;i++){if(!arrayContains(list,value[i])){return false;}}
return true;}
var _type=getType(value);for(i=0,length=list.length;i<length;i++){if(_type==='RegExp'){if(typeof list[i]==='string'&&list[i].match(value)){return true;}}else if(list[i]===value){return true;}}
return false;}
function arraysEqual(one,two){if(!isArray(one)||!isArray(two)){return false;}
if(one.length!==two.length){return false;}
one.sort();two.sort();for(var i=0,l=one.length;i<l;i++){if(one[i]!==two[i]){return false;}}
return true;}
URI._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:URI.duplicateQueryParameters,escapeQuerySpace:URI.escapeQuerySpace};};URI.duplicateQueryParameters=false;URI.escapeQuerySpace=true;URI.protocol_expression=/^[a-z][a-z0-9-+-]*$/i;URI.idn_expression=/[^a-z0-9\.-]/i;URI.punycode_expression=/(xn--)/i;URI.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;URI.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;URI.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;URI.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};URI.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;URI.domAttributes={'a':'href','blockquote':'cite','link':'href','base':'href','script':'src','form':'action','img':'src','area':'href','iframe':'src','embed':'src','source':'src','track':'src','input':'src'};URI.getDomAttribute=function(node){if(!node||!node.nodeName){return undefined;}
var nodeName=node.nodeName.toLowerCase();if(nodeName==='input'&&node.type!=='image'){return undefined;}
return URI.domAttributes[nodeName];};function escapeForDumbFirefox36(value){return escape(value);}
function strictEncodeURIComponent(string){return encodeURIComponent(string).replace(/[!'()*]/g,escapeForDumbFirefox36).replace(/\*/g,"%2A");}
URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent;URI.iso8859=function(){URI.encode=escape;URI.decode=unescape;};URI.unicode=function(){URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent;};URI.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};URI.encodeQuery=function(string,escapeQuerySpace){var escaped=URI.encode(string+"");return escapeQuerySpace?escaped.replace(/%20/g,'+'):escaped;};URI.decodeQuery=function(string,escapeQuerySpace){string+="";try{return URI.decode(escapeQuerySpace?string.replace(/\+/g,'%20'):string);}catch(e){return string;}};URI.recodePath=function(string){var segments=(string+"").split('/');for(var i=0,length=segments.length;i<length;i++){segments[i]=URI.encodePathSegment(URI.decode(segments[i]));}
return segments.join('/');};URI.decodePath=function(string){var segments=(string+"").split('/');for(var i=0,length=segments.length;i<length;i++){segments[i]=URI.decodePathSegment(segments[i]);}
return segments.join('/');};var _parts={'encode':'encode','decode':'decode'};var _part;var generateAccessor=function(_group,_part){return function(string){return URI[_part](string+"").replace(URI.characters[_group][_part].expression,function(c){return URI.characters[_group][_part].map[c];});};};for(_part in _parts){URI[_part+"PathSegment"]=generateAccessor("pathname",_parts[_part]);}
URI.encodeReserved=generateAccessor("reserved","encode");URI.parse=function(string,parts){var pos;if(!parts){parts={};}
pos=string.indexOf('#');if(pos>-1){parts.fragment=string.substring(pos+1)||null;string=string.substring(0,pos);}
pos=string.indexOf('?');if(pos>-1){parts.query=string.substring(pos+1)||null;string=string.substring(0,pos);}
if(string.substring(0,2)==='//'){parts.protocol=null;string=string.substring(2);string=URI.parseAuthority(string,parts);}else{pos=string.indexOf(':');if(pos>-1){parts.protocol=string.substring(0,pos)||null;if(parts.protocol&&!parts.protocol.match(URI.protocol_expression)){parts.protocol=undefined;}else if(parts.protocol==='file'){string=string.substring(pos+3);}else if(string.substring(pos+1,pos+3)==='//'){string=string.substring(pos+3);string=URI.parseAuthority(string,parts);}else{string=string.substring(pos+1);parts.urn=true;}}}
parts.path=string;return parts;};URI.parseHost=function(string,parts){var pos=string.indexOf('/');var bracketPos;var t;if(pos===-1){pos=string.length;}
if(string.charAt(0)==="["){bracketPos=string.indexOf(']');parts.hostname=string.substring(1,bracketPos)||null;parts.port=string.substring(bracketPos+2,pos)||null;}else if(string.indexOf(':')!==string.lastIndexOf(':')){parts.hostname=string.substring(0,pos)||null;parts.port=null;}else{t=string.substring(0,pos).split(':');parts.hostname=t[0]||null;parts.port=t[1]||null;}
if(parts.hostname&&string.substring(pos).charAt(0)!=='/'){pos++;string="/"+string;}
return string.substring(pos)||'/';};URI.parseAuthority=function(string,parts){string=URI.parseUserinfo(string,parts);return URI.parseHost(string,parts);};URI.parseUserinfo=function(string,parts){var firstSlash=string.indexOf('/');var pos=firstSlash>-1?string.lastIndexOf('@',firstSlash):string.indexOf('@');var t;if(pos>-1&&(firstSlash===-1||pos<firstSlash)){t=string.substring(0,pos).split(':');parts.username=t[0]?URI.decode(t[0]):null;t.shift();parts.password=t[0]?URI.decode(t.join(':')):null;string=string.substring(pos+1);}else{parts.username=null;parts.password=null;}
return string;};URI.parseQuery=function(string,escapeQuerySpace){if(!string){return{};}
string=string.replace(/&+/g,'&').replace(/^\?*&*|&+$/g,'');if(!string){return{};}
var items={};var splits=string.split('&');var length=splits.length;var v,name,value;for(var i=0;i<length;i++){v=splits[i].split('=');name=URI.decodeQuery(v.shift(),escapeQuerySpace);value=v.length?URI.decodeQuery(v.join('='),escapeQuerySpace):null;if(items[name]){if(typeof items[name]==="string"){items[name]=[items[name]];}
items[name].push(value);}else{items[name]=value;}}
return items;};URI.build=function(parts){var t="";if(parts.protocol){t+=parts.protocol+":";}
if(!parts.urn&&(t||parts.hostname)){t+='//';}
t+=(URI.buildAuthority(parts)||'');if(typeof parts.path==="string"){if(parts.path.charAt(0)!=='/'&&typeof parts.hostname==="string"){t+='/';}
t+=parts.path;}
if(typeof parts.query==="string"&&parts.query){t+='?'+parts.query;}
if(typeof parts.fragment==="string"&&parts.fragment){t+='#'+parts.fragment;}
return t;};URI.buildHost=function(parts){var t="";if(!parts.hostname){return"";}else if(URI.ip6_expression.test(parts.hostname)){if(parts.port){t+="["+parts.hostname+"]:"+parts.port;}else{t+=parts.hostname;}}else{t+=parts.hostname;if(parts.port){t+=':'+parts.port;}}
return t;};URI.buildAuthority=function(parts){return URI.buildUserinfo(parts)+URI.buildHost(parts);};URI.buildUserinfo=function(parts){var t="";if(parts.username){t+=URI.encode(parts.username);if(parts.password){t+=':'+URI.encode(parts.password);}
t+="@";}
return t;};URI.buildQuery=function(data,duplicateQueryParameters,escapeQuerySpace){var t="";var unique,key,i,length;for(key in data){if(hasOwn.call(data,key)&&key){if(isArray(data[key])){unique={};for(i=0,length=data[key].length;i<length;i++){if(data[key][i]!==undefined&&unique[data[key][i]+""]===undefined){t+="&"+URI.buildQueryParameter(key,data[key][i],escapeQuerySpace);if(duplicateQueryParameters!==true){unique[data[key][i]+""]=true;}}}}else if(data[key]!==undefined){t+='&'+URI.buildQueryParameter(key,data[key],escapeQuerySpace);}}}
return t.substring(1);};URI.buildQueryParameter=function(name,value,escapeQuerySpace){return URI.encodeQuery(name,escapeQuerySpace)+(value!==null?"="+URI.encodeQuery(value,escapeQuerySpace):"");};URI.addQuery=function(data,name,value){if(typeof name==="object"){for(var key in name){if(hasOwn.call(name,key)){URI.addQuery(data,key,name[key]);}}}else if(typeof name==="string"){if(data[name]===undefined){data[name]=value;return;}else if(typeof data[name]==="string"){data[name]=[data[name]];}
if(!isArray(value)){value=[value];}
data[name]=data[name].concat(value);}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");}};URI.removeQuery=function(data,name,value){var i,length,key;if(isArray(name)){for(i=0,length=name.length;i<length;i++){data[name[i]]=undefined;}}else if(typeof name==="object"){for(key in name){if(hasOwn.call(name,key)){URI.removeQuery(data,key,name[key]);}}}else if(typeof name==="string"){if(value!==undefined){if(data[name]===value){data[name]=undefined;}else if(isArray(data[name])){data[name]=filterArrayValues(data[name],value);}}else{data[name]=undefined;}}else{throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");}};URI.hasQuery=function(data,name,value,withinArray){if(typeof name==="object"){for(var key in name){if(hasOwn.call(name,key)){if(!URI.hasQuery(data,key,name[key])){return false;}}}
return true;}else if(typeof name!=="string"){throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");}
switch(getType(value)){case'Undefined':return name in data;case'Boolean':var _booly=Boolean(isArray(data[name])?data[name].length:data[name]);return value===_booly;case'Function':return!!value(data[name],name,data);case'Array':if(!isArray(data[name])){return false;}
var op=withinArray?arrayContains:arraysEqual;return op(data[name],value);case'RegExp':if(!isArray(data[name])){return Boolean(data[name]&&data[name].match(value));}
if(!withinArray){return false;}
return arrayContains(data[name],value);case'Number':value=String(value);case'String':if(!isArray(data[name])){return data[name]===value;}
if(!withinArray){return false;}
return arrayContains(data[name],value);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter");}};URI.commonPath=function(one,two){var length=Math.min(one.length,two.length);var pos;for(pos=0;pos<length;pos++){if(one.charAt(pos)!==two.charAt(pos)){pos--;break;}}
if(pos<1){return one.charAt(0)===two.charAt(0)&&one.charAt(0)==='/'?'/':'';}
if(one.charAt(pos)!=='/'||two.charAt(pos)!=='/'){pos=one.substring(0,pos).lastIndexOf('/');}
return one.substring(0,pos+1);};URI.withinString=function(string,callback){return string.replace(URI.find_uri_expression,callback);};URI.ensureValidHostname=function(v){if(v.match(URI.invalid_hostname_characters)){if(!punycode){throw new TypeError("Hostname '"+v+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");}
if(punycode.toASCII(v).match(URI.invalid_hostname_characters)){throw new TypeError("Hostname '"+v+"' contains characters other than [A-Z0-9.-]");}}};URI.noConflict=function(removeAll){if(removeAll){var unconflicted={URI:this.noConflict()};if(URITemplate&&typeof URITemplate.noConflict=="function"){unconflicted.URITemplate=URITemplate.noConflict();}
if(IPv6&&typeof IPv6.noConflict=="function"){unconflicted.IPv6=IPv6.noConflict();}
if(SecondLevelDomains&&typeof SecondLevelDomains.noConflict=="function"){unconflicted.SecondLevelDomains=SecondLevelDomains.noConflict();}
return unconflicted;}else if(root.URI===this){root.URI=_URI;}
return this;};p.build=function(deferBuild){if(deferBuild===true){this._deferred_build=true;}else if(deferBuild===undefined||this._deferred_build){this._string=URI.build(this._parts);this._deferred_build=false;}
return this;};p.clone=function(){return new URI(this);};p.valueOf=p.toString=function(){return this.build(false)._string;};_parts={protocol:'protocol',username:'username',password:'password',hostname:'hostname',port:'port'};generateAccessor=function(_part){return function(v,build){if(v===undefined){return this._parts[_part]||"";}else{this._parts[_part]=v||null;this.build(!build);return this;}};};for(_part in _parts){p[_part]=generateAccessor(_parts[_part]);}
_parts={query:'?',fragment:'#'};generateAccessor=function(_part,_key){return function(v,build){if(v===undefined){return this._parts[_part]||"";}else{if(v!==null){v=v+"";if(v.charAt(0)===_key){v=v.substring(1);}}
this._parts[_part]=v;this.build(!build);return this;}};};for(_part in _parts){p[_part]=generateAccessor(_part,_parts[_part]);}
_parts={search:['?','query'],hash:['#','fragment']};generateAccessor=function(_part,_key){return function(v,build){var t=this[_part](v,build);return typeof t==="string"&&t.length?(_key+t):t;};};for(_part in _parts){p[_part]=generateAccessor(_parts[_part][1],_parts[_part][0]);}
p.pathname=function(v,build){if(v===undefined||v===true){var res=this._parts.path||(this._parts.hostname?'/':'');return v?URI.decodePath(res):res;}else{this._parts.path=v?URI.recodePath(v):"/";this.build(!build);return this;}};p.path=p.pathname;p.href=function(href,build){var key;if(href===undefined){return this.toString();}
this._string="";this._parts=URI._parts();var _URI=href instanceof URI;var _object=typeof href==="object"&&(href.hostname||href.path||href.pathname);if(href.nodeName){var attribute=URI.getDomAttribute(href);href=href[attribute]||"";_object=false;}
if(!_URI&&_object&&href.pathname!==undefined){href=href.toString();}
if(typeof href==="string"){this._parts=URI.parse(href,this._parts);}else if(_URI||_object){var src=_URI?href._parts:href;for(key in src){if(hasOwn.call(this._parts,key)){this._parts[key]=src[key];}}}else{throw new TypeError("invalid input");}
this.build(!build);return this;};p.is=function(what){var ip=false;var ip4=false;var ip6=false;var name=false;var sld=false;var idn=false;var punycode=false;var relative=!this._parts.urn;if(this._parts.hostname){relative=false;ip4=URI.ip4_expression.test(this._parts.hostname);ip6=URI.ip6_expression.test(this._parts.hostname);ip=ip4||ip6;name=!ip;sld=name&&SLD&&SLD.has(this._parts.hostname);idn=name&&URI.idn_expression.test(this._parts.hostname);punycode=name&&URI.punycode_expression.test(this._parts.hostname);}
switch(what.toLowerCase()){case'relative':return relative;case'absolute':return!relative;case'domain':case'name':return name;case'sld':return sld;case'ip':return ip;case'ip4':case'ipv4':case'inet4':return ip4;case'ip6':case'ipv6':case'inet6':return ip6;case'idn':return idn;case'url':return!this._parts.urn;case'urn':return!!this._parts.urn;case'punycode':return punycode;}
return null;};var _protocol=p.protocol;var _port=p.port;var _hostname=p.hostname;p.protocol=function(v,build){if(v!==undefined){if(v){v=v.replace(/:(\/\/)?$/,'');if(v.match(/[^a-zA-z0-9\.+-]/)){throw new TypeError("Protocol '"+v+"' contains characters other than [A-Z0-9.+-]");}}}
return _protocol.call(this,v,build);};p.scheme=p.protocol;p.port=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v!==undefined){if(v===0){v=null;}
if(v){v+="";if(v.charAt(0)===":"){v=v.substring(1);}
if(v.match(/[^0-9]/)){throw new TypeError("Port '"+v+"' contains characters other than [0-9]");}}}
return _port.call(this,v,build);};p.hostname=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v!==undefined){var x={};URI.parseHost(v,x);v=x.hostname;}
return _hostname.call(this,v,build);};p.host=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined){return this._parts.hostname?URI.buildHost(this._parts):"";}else{URI.parseHost(v,this._parts);this.build(!build);return this;}};p.authority=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined){return this._parts.hostname?URI.buildAuthority(this._parts):"";}else{URI.parseAuthority(v,this._parts);this.build(!build);return this;}};p.userinfo=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined){if(!this._parts.username){return"";}
var t=URI.buildUserinfo(this._parts);return t.substring(0,t.length-1);}else{if(v[v.length-1]!=='@'){v+='@';}
URI.parseUserinfo(v,this._parts);this.build(!build);return this;}};p.resource=function(v,build){var parts;if(v===undefined){return this.path()+this.search()+this.hash();}
parts=URI.parse(v);this._parts.path=parts.path;this._parts.query=parts.query;this._parts.fragment=parts.fragment;this.build(!build);return this;};p.subdomain=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return"";}
var end=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,end)||"";}else{var e=this._parts.hostname.length-this.domain().length;var sub=this._parts.hostname.substring(0,e);var replace=new RegExp('^'+escapeRegEx(sub));if(v&&v.charAt(v.length-1)!=='.'){v+=".";}
if(v){URI.ensureValidHostname(v);}
this._parts.hostname=this._parts.hostname.replace(replace,v);this.build(!build);return this;}};p.domain=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(typeof v==='boolean'){build=v;v=undefined;}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return"";}
var t=this._parts.hostname.match(/\./g);if(t&&t.length<2){return this._parts.hostname;}
var end=this._parts.hostname.length-this.tld(build).length-1;end=this._parts.hostname.lastIndexOf('.',end-1)+1;return this._parts.hostname.substring(end)||"";}else{if(!v){throw new TypeError("cannot set domain empty");}
URI.ensureValidHostname(v);if(!this._parts.hostname||this.is('IP')){this._parts.hostname=v;}else{var replace=new RegExp(escapeRegEx(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(replace,v);}
this.build(!build);return this;}};p.tld=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(typeof v==='boolean'){build=v;v=undefined;}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return"";}
var pos=this._parts.hostname.lastIndexOf('.');var tld=this._parts.hostname.substring(pos+1);if(build!==true&&SLD&&SLD.list[tld.toLowerCase()]){return SLD.get(this._parts.hostname)||tld;}
return tld;}else{var replace;if(!v){throw new TypeError("cannot set TLD empty");}else if(v.match(/[^a-zA-Z0-9-]/)){if(SLD&&SLD.is(v)){replace=new RegExp(escapeRegEx(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(replace,v);}else{throw new TypeError("TLD '"+v+"' contains characters other than [A-Z0-9]");}}else if(!this._parts.hostname||this.is('IP')){throw new ReferenceError("cannot set TLD on non-domain host");}else{replace=new RegExp(escapeRegEx(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(replace,v);}
this.build(!build);return this;}};p.directory=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined||v===true){if(!this._parts.path&&!this._parts.hostname){return'';}
if(this._parts.path==='/'){return'/';}
var end=this._parts.path.length-this.filename().length-1;var res=this._parts.path.substring(0,end)||(this._parts.hostname?"/":"");return v?URI.decodePath(res):res;}else{var e=this._parts.path.length-this.filename().length;var directory=this._parts.path.substring(0,e);var replace=new RegExp('^'+escapeRegEx(directory));if(!this.is('relative')){if(!v){v='/';}
if(v.charAt(0)!=='/'){v="/"+v;}}
if(v&&v.charAt(v.length-1)!=='/'){v+='/';}
v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v);this.build(!build);return this;}};p.filename=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined||v===true){if(!this._parts.path||this._parts.path==='/'){return"";}
var pos=this._parts.path.lastIndexOf('/');var res=this._parts.path.substring(pos+1);return v?URI.decodePathSegment(res):res;}else{var mutatedDirectory=false;if(v.charAt(0)==='/'){v=v.substring(1);}
if(v.match(/\.?\//)){mutatedDirectory=true;}
var replace=new RegExp(escapeRegEx(this.filename())+"$");v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v);if(mutatedDirectory){this.normalizePath(build);}else{this.build(!build);}
return this;}};p.suffix=function(v,build){if(this._parts.urn){return v===undefined?'':this;}
if(v===undefined||v===true){if(!this._parts.path||this._parts.path==='/'){return"";}
var filename=this.filename();var pos=filename.lastIndexOf('.');var s,res;if(pos===-1){return"";}
s=filename.substring(pos+1);res=(/^[a-z0-9%]+$/i).test(s)?s:"";return v?URI.decodePathSegment(res):res;}else{if(v.charAt(0)==='.'){v=v.substring(1);}
var suffix=this.suffix();var replace;if(!suffix){if(!v){return this;}
this._parts.path+='.'+URI.recodePath(v);}else if(!v){replace=new RegExp(escapeRegEx("."+suffix)+"$");}else{replace=new RegExp(escapeRegEx(suffix)+"$");}
if(replace){v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v);}
this.build(!build);return this;}};p.segment=function(segment,v,build){var separator=this._parts.urn?':':'/';var path=this.path();var absolute=path.substring(0,1)==='/';var segments=path.split(separator);if(segment!==undefined&&typeof segment!=='number'){build=v;v=segment;segment=undefined;}
if(segment!==undefined&&typeof segment!=='number'){throw new Error("Bad segment '"+segment+"', must be 0-based integer");}
if(absolute){segments.shift();}
if(segment<0){segment=Math.max(segments.length+segment,0);}
if(v===undefined){return segment===undefined?segments:segments[segment];}else if(segment===null||segments[segment]===undefined){if(isArray(v)){segments=[];for(var i=0,l=v.length;i<l;i++){if(!v[i].length&&(!segments.length||!segments[segments.length-1].length)){continue;}
if(segments.length&&!segments[segments.length-1].length){segments.pop();}
segments.push(v[i]);}}else if(v||(typeof v==="string")){if(segments[segments.length-1]===""){segments[segments.length-1]=v;}else{segments.push(v);}}}else{if(v||(typeof v==="string"&&v.length)){segments[segment]=v;}else{segments.splice(segment,1);}}
if(absolute){segments.unshift("");}
return this.path(segments.join(separator),build);};p.segmentCoded=function(segment,v,build){var segments,i,l;if(typeof segment!=='number'){build=v;v=segment;segment=undefined;}
if(v===undefined){segments=this.segment(segment,v,build);if(!isArray(segments)){segments=segments!==undefined?URI.decode(segments):undefined;}else{for(i=0,l=segments.length;i<l;i++){segments[i]=URI.decode(segments[i]);}}
return segments;}
if(!isArray(v)){v=typeof v==='string'?URI.encode(v):v;}else{for(i=0,l=v.length;i<l;i++){v[i]=URI.decode(v[i]);}}
return this.segment(segment,v,build);};var q=p.query;p.query=function(v,build){if(v===true){return URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);}else if(typeof v==="function"){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);var result=v.call(this,data);this._parts.query=URI.buildQuery(result||data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!build);return this;}else if(v!==undefined&&typeof v!=="string"){this._parts.query=URI.buildQuery(v,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!build);return this;}else{return q.call(this,v,build);}};p.setQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof name==="object"){for(var key in name){if(hasOwn.call(name,key)){data[key]=name[key];}}}else if(typeof name==="string"){data[name]=value!==undefined?value:null;}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");}
this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=="string"){build=value;}
this.build(!build);return this;};p.addQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);URI.addQuery(data,name,value===undefined?null:value);this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=="string"){build=value;}
this.build(!build);return this;};p.removeQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);URI.removeQuery(data,name,value);this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=="string"){build=value;}
this.build(!build);return this;};p.hasQuery=function(name,value,withinArray){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return URI.hasQuery(data,name,value,withinArray);};p.setSearch=p.setQuery;p.addSearch=p.addQuery;p.removeSearch=p.removeQuery;p.hasSearch=p.hasQuery;p.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(false).normalizeQuery(false).normalizeFragment(false).build();}
return this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build();};p.normalizeProtocol=function(build){if(typeof this._parts.protocol==="string"){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!build);}
return this;};p.normalizeHostname=function(build){if(this._parts.hostname){if(this.is('IDN')&&punycode){this._parts.hostname=punycode.toASCII(this._parts.hostname);}else if(this.is('IPv6')&&IPv6){this._parts.hostname=IPv6.best(this._parts.hostname);}
this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!build);}
return this;};p.normalizePort=function(build){if(typeof this._parts.protocol==="string"&&this._parts.port===URI.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!build);}
return this;};p.normalizePath=function(build){if(this._parts.urn){return this;}
if(!this._parts.path||this._parts.path==='/'){return this;}
var _was_relative;var _path=this._parts.path;var _parent,_pos;if(_path.charAt(0)!=='/'){_was_relative=true;_path='/'+_path;}
_path=_path.replace(/(\/(\.\/)+)|(\/\.$)/g,'/').replace(/\/{2,}/g,'/');while(true){_parent=_path.indexOf('/..');if(_parent===-1){break;}else if(_parent===0){_path=_path.substring(3);continue;}
_pos=_path.substring(0,_parent).lastIndexOf('/');if(_pos===-1){_pos=_parent;}
_path=_path.substring(0,_pos)+_path.substring(_parent+3);}
if(_was_relative&&this.is('relative')){_path=_path.substring(1);}
_path=URI.recodePath(_path);this._parts.path=_path;this.build(!build);return this;};p.normalizePathname=p.normalizePath;p.normalizeQuery=function(build){if(typeof this._parts.query==="string"){if(!this._parts.query.length){this._parts.query=null;}else{this.query(URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace));}
this.build(!build);}
return this;};p.normalizeFragment=function(build){if(!this._parts.fragment){this._parts.fragment=null;this.build(!build);}
return this;};p.normalizeSearch=p.normalizeQuery;p.normalizeHash=p.normalizeFragment;p.iso8859=function(){var e=URI.encode;var d=URI.decode;URI.encode=escape;URI.decode=decodeURIComponent;this.normalize();URI.encode=e;URI.decode=d;return this;};p.unicode=function(){var e=URI.encode;var d=URI.decode;URI.encode=strictEncodeURIComponent;URI.decode=unescape;this.normalize();URI.encode=e;URI.decode=d;return this;};p.readable=function(){var uri=this.clone();uri.username("").password("").normalize();var t='';if(uri._parts.protocol){t+=uri._parts.protocol+'://';}
if(uri._parts.hostname){if(uri.is('punycode')&&punycode){t+=punycode.toUnicode(uri._parts.hostname);if(uri._parts.port){t+=":"+uri._parts.port;}}else{t+=uri.host();}}
if(uri._parts.hostname&&uri._parts.path&&uri._parts.path.charAt(0)!=='/'){t+='/';}
t+=uri.path(true);if(uri._parts.query){var q='';for(var i=0,qp=uri._parts.query.split('&'),l=qp.length;i<l;i++){var kv=(qp[i]||"").split('=');q+='&'+URI.decodeQuery(kv[0],this._parts.escapeQuerySpace).replace(/&/g,'%26');if(kv[1]!==undefined){q+="="+URI.decodeQuery(kv[1],this._parts.escapeQuerySpace).replace(/&/g,'%26');}}
t+='?'+q.substring(1);}
t+=URI.decodeQuery(uri.hash(),true);return t;};p.absoluteTo=function(base){var resolved=this.clone();var properties=['protocol','username','password','hostname','port'];var basedir,i,p;if(this._parts.urn){throw new Error('URNs do not have any generally defined hierarchical components');}
if(!(base instanceof URI)){base=new URI(base);}
if(!resolved._parts.protocol){resolved._parts.protocol=base._parts.protocol;}
if(this._parts.hostname){return resolved;}
for(i=0;p=properties[i];i++){resolved._parts[p]=base._parts[p];}
if(!resolved._parts.path){resolved._parts.path=base._parts.path;if(!resolved._parts.query){resolved._parts.query=base._parts.query;}}else if(resolved._parts.path.substring(-2)==='..'){resolved._parts.path+='/';}
if(resolved.path().charAt(0)!=='/'){basedir=base.directory();resolved._parts.path=(basedir?(basedir+'/'):'')+resolved._parts.path;resolved.normalizePath();}
resolved.build();return resolved;};p.relativeTo=function(base){var relative=this.clone().normalize();var relativeParts,baseParts,common,relativePath,basePath;if(relative._parts.urn){throw new Error('URNs do not have any generally defined hierarchical components');}
base=new URI(base).normalize();relativeParts=relative._parts;baseParts=base._parts;relativePath=relative.path();basePath=base.path();if(relativePath.charAt(0)!=='/'){throw new Error('URI is already relative');}
if(basePath.charAt(0)!=='/'){throw new Error('Cannot calculate a URI relative to another relative URI');}
if(relativeParts.protocol===baseParts.protocol){relativeParts.protocol=null;}
if(relativeParts.username!==baseParts.username||relativeParts.password!==baseParts.password){return relative.build();}
if(relativeParts.protocol!==null||relativeParts.username!==null||relativeParts.password!==null){return relative.build();}
if(relativeParts.hostname===baseParts.hostname&&relativeParts.port===baseParts.port){relativeParts.hostname=null;relativeParts.port=null;}else{return relative.build();}
if(relativePath===basePath){relativeParts.path='';return relative.build();}
common=URI.commonPath(relative.path(),base.path());if(!common){return relative.build();}
var parents=baseParts.path.substring(common.length).replace(/[^\/]*$/,'').replace(/.*?\//g,'../');relativeParts.path=parents+relativeParts.path.substring(common.length);return relative.build();};p.equals=function(uri){var one=this.clone();var two=new URI(uri);var one_map={};var two_map={};var checked={};var one_query,two_query,key;one.normalize();two.normalize();if(one.toString()===two.toString()){return true;}
one_query=one.query();two_query=two.query();one.query("");two.query("");if(one.toString()!==two.toString()){return false;}
if(one_query.length!==two_query.length){return false;}
one_map=URI.parseQuery(one_query,this._parts.escapeQuerySpace);two_map=URI.parseQuery(two_query,this._parts.escapeQuerySpace);for(key in one_map){if(hasOwn.call(one_map,key)){if(!isArray(one_map[key])){if(one_map[key]!==two_map[key]){return false;}}else if(!arraysEqual(one_map[key],two_map[key])){return false;}
checked[key]=true;}}
for(key in two_map){if(hasOwn.call(two_map,key)){if(!checked[key]){return false;}}}
return true;};p.duplicateQueryParameters=function(v){this._parts.duplicateQueryParameters=!!v;return this;};p.escapeQuerySpace=function(v){this._parts.escapeQuerySpace=!!v;return this;};return URI;}));
(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('./URI'));}else if(typeof define==='function'&&define.amd){define(['./URI'],factory);}else{root.URITemplate=factory(root.URI,root);}}(this,function(URI,root){"use strict";var _URITemplate=root&&root.URITemplate;var hasOwn=Object.prototype.hasOwnProperty;function URITemplate(expression){if(URITemplate._cache[expression]){return URITemplate._cache[expression];}
if(!(this instanceof URITemplate)){return new URITemplate(expression);}
this.expression=expression;URITemplate._cache[expression]=this;return this;}
function Data(data){this.data=data;this.cache={};}
var p=URITemplate.prototype;var operators={'':{prefix:"",separator:",",named:false,empty_name_separator:false,encode:"encode"},'+':{prefix:"",separator:",",named:false,empty_name_separator:false,encode:"encodeReserved"},'#':{prefix:"#",separator:",",named:false,empty_name_separator:false,encode:"encodeReserved"},'.':{prefix:".",separator:".",named:false,empty_name_separator:false,encode:"encode"},'/':{prefix:"/",separator:"/",named:false,empty_name_separator:false,encode:"encode"},';':{prefix:";",separator:";",named:true,empty_name_separator:false,encode:"encode"},'?':{prefix:"?",separator:"&",named:true,empty_name_separator:true,encode:"encode"},'&':{prefix:"&",separator:"&",named:true,empty_name_separator:true,encode:"encode"}};URITemplate._cache={};URITemplate.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g;URITemplate.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/;URITemplate.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/;URITemplate.expand=function(expression,data){var options=operators[expression.operator];var type=options.named?"Named":"Unnamed";var variables=expression.variables;var buffer=[];var d,variable,i,l,value;for(i=0;variable=variables[i];i++){d=data.get(variable.name);if(!d.val.length){if(d.type){buffer.push("");}
continue;}
buffer.push(URITemplate["expand"+type](d,options,variable.explode,variable.explode&&options.separator||",",variable.maxlength,variable.name));}
if(buffer.length){return options.prefix+buffer.join(options.separator);}else{return"";}};URITemplate.expandNamed=function(d,options,explode,separator,length,name){var result="";var encode=options.encode;var empty_name_separator=options.empty_name_separator;var _encode=!d[encode].length;var _name=d.type===2?'':URI[encode](name);var _value,i,l;for(i=0,l=d.val.length;i<l;i++){if(length){_value=URI[encode](d.val[i][1].substring(0,length));if(d.type===2){_name=URI[encode](d.val[i][0].substring(0,length));}}else if(_encode){_value=URI[encode](d.val[i][1]);if(d.type===2){_name=URI[encode](d.val[i][0]);d[encode].push([_name,_value]);}else{d[encode].push([undefined,_value]);}}else{_value=d[encode][i][1];if(d.type===2){_name=d[encode][i][0];}}
if(result){result+=separator;}
if(!explode){if(!i){result+=URI[encode](name)+(empty_name_separator||_value?"=":"");}
if(d.type===2){result+=_name+",";}
result+=_value;}else{result+=_name+(empty_name_separator||_value?"=":"")+_value;}}
return result;};URITemplate.expandUnnamed=function(d,options,explode,separator,length,name){var result="";var encode=options.encode;var empty_name_separator=options.empty_name_separator;var _encode=!d[encode].length;var _name,_value,i,l;for(i=0,l=d.val.length;i<l;i++){if(length){_value=URI[encode](d.val[i][1].substring(0,length));}else if(_encode){_value=URI[encode](d.val[i][1]);d[encode].push([d.type===2?URI[encode](d.val[i][0]):undefined,_value]);}else{_value=d[encode][i][1];}
if(result){result+=separator;}
if(d.type===2){if(length){_name=URI[encode](d.val[i][0].substring(0,length));}else{_name=d[encode][i][0];}
result+=_name;if(explode){result+=(empty_name_separator||_value?"=":"");}else{result+=",";}}
result+=_value;}
return result;};URITemplate.noConflict=function(){if(root.URITemplate===URITemplate){root.URITemplate=_URITemplate;}
return URITemplate;};p.expand=function(data){var result="";if(!this.parts||!this.parts.length){this.parse();}
if(!(data instanceof Data)){data=new Data(data);}
for(var i=0,l=this.parts.length;i<l;i++){result+=typeof this.parts[i]==="string"?this.parts[i]:URITemplate.expand(this.parts[i],data);}
return result;};p.parse=function(){var expression=this.expression;var ePattern=URITemplate.EXPRESSION_PATTERN;var vPattern=URITemplate.VARIABLE_PATTERN;var nPattern=URITemplate.VARIABLE_NAME_PATTERN;var parts=[];var pos=0;var variables,eMatch,vMatch;ePattern.lastIndex=0;while(true){eMatch=ePattern.exec(expression);if(eMatch===null){parts.push(expression.substring(pos));break;}else{parts.push(expression.substring(pos,eMatch.index));pos=eMatch.index+eMatch[0].length;}
if(!operators[eMatch[1]]){throw new Error('Unknown Operator "'+eMatch[1]+'" in "'+eMatch[0]+'"');}else if(!eMatch[3]){throw new Error('Unclosed Expression "'+eMatch[0]+'"');}
variables=eMatch[2].split(',');for(var i=0,l=variables.length;i<l;i++){vMatch=variables[i].match(vPattern);if(vMatch===null){throw new Error('Invalid Variable "'+variables[i]+'" in "'+eMatch[0]+'"');}else if(vMatch[1].match(nPattern)){throw new Error('Invalid Variable Name "'+vMatch[1]+'" in "'+eMatch[0]+'"');}
variables[i]={name:vMatch[1],explode:!!vMatch[3],maxlength:vMatch[4]&&parseInt(vMatch[4],10)};}
if(!variables.length){throw new Error('Expression Missing Variable(s) "'+eMatch[0]+'"');}
parts.push({expression:eMatch[0],operator:eMatch[1],variables:variables});}
if(!parts.length){parts.push(expression);}
this.parts=parts;return this;};Data.prototype.get=function(key){var data=this.data;var d={type:0,val:[],encode:[],encodeReserved:[]};var i,l,value;if(this.cache[key]!==undefined){return this.cache[key];}
this.cache[key]=d;if(String(Object.prototype.toString.call(data))==="[object Function]"){value=data(key);}else if(String(Object.prototype.toString.call(data[key]))==="[object Function]"){value=data[key](key);}else{value=data[key];}
if(value===undefined||value===null){return d;}else if(String(Object.prototype.toString.call(value))==="[object Array]"){for(i=0,l=value.length;i<l;i++){if(value[i]!==undefined&&value[i]!==null){d.val.push([undefined,String(value[i])]);}}
if(d.val.length){d.type=3;}}else if(String(Object.prototype.toString.call(value))==="[object Object]"){for(i in value){if(hasOwn.call(value,i)&&value[i]!==undefined&&value[i]!==null){d.val.push([i,String(value[i])]);}}
if(d.val.length){d.type=2;}}else{d.type=1;d.val.push([undefined,String(value)]);}
return d;};URI.expand=function(expression,data){var template=new URITemplate(expression);var expansion=template.expand(data);return new URI(expansion);};return URITemplate;}));(function(){var e,t;(function(){"use strict";var r={},n={};e=function(e,t,n){r[e]={deps:t,callback:n}},t=function(e){if(n[e])return n[e];n[e]={};for(var i,o=r[e],s=o.deps,a=o.callback,c=[],u=0,p=s.length;p>u;u++)"exports"===s[u]?c.push(i={}):c.push(t(s[u]));var h=a.apply(this,c);return n[e]=i||h}})(),e("hyperagent",["hyperagent/resource","hyperagent/properties","hyperagent/curie","hyperagent/config","exports"],function(e,t,r,n,i){"use strict";function o(e,t){n[e]=t}var s=e.Resource,a=e.LazyResource,c=e.LinkResource,u=t.Properties,p=r.CurieStore;i.Resource=s,i.Properties=u,i.LazyResource=a,i.LinkResource=c,i.CurieStore=p,i.configure=o}),e("hyperagent/config",["hyperagent/miniscore"],function(e){"use strict";var t={};return"undefined"!=typeof window&&(t.ajax=window.$&&window.$.ajax.bind(window.$),t.defer=window.Q&&window.Q.defer,t._=e),t}),e("hyperagent/curie",["exports"],function(e){"use strict";function t(){this._store={}}t.prototype.register=function(e,t){this._store[e]=URITemplate(t)},t._split=function(e){var t=e.indexOf(":"),r=e.substring(0,t),n=e.substring(t+1);return-1===e||e===e.length-1?null:[r,n]},t.prototype.empty=function(){return 0===Object.keys(this._store).length},t.prototype.expand=function(e){var r,n=t._split(e);return n?(r=this._store[n[0]],void 0===r?e:r.expand({rel:n[1]})):e},t.prototype.canExpand=function(e){var r=t._split(e);return r?void 0!==this._store[r[0]]:!1},e.CurieStore=t}),e("hyperagent/loader",["hyperagent/config","exports"],function(e,t){"use strict";function r(t){var r=e.defer();return e.ajax(e._.extend(t,{headers:{Accept:"application/hal+json, application/json, */*; q=0.01","X-Requested-With":"XMLHttpRequest"},success:r.resolve,error:r.reject,dataType:"html"})),r.promise}t.loadAjax=r}),e("hyperagent/miniscore",[],function(){"use strict";var e={},t={};return e.each=e.forEach=function(e,r,n){if(null!==e&&void 0!==e)if(e.forEach===Array.prototype.forEach)e.forEach(r,n);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(r.call(n,e[i],i,e)===t)return}else for(var s in e)if(e.hasOwnProperty(s)&&r.call(n,e[s],s,e)===t)return},e.identity=function(e){return e},e.any=function(r,n,i){var o=!1;return n||(n=e.identity),null===r||void 0===r?o:r.some===Array.prototype.some?r.some(n,i):(e.each(r,function(e,r,s){return o||(o=n.call(i,e,r,s))?t:void 0}),!!o)},e.contains=function(t,r){return null===t||void 0===t?!1:t.indexOf===Array.prototype.indexOf?-1!==t.indexOf(r):e.any(t,function(e){return e===r})},e.pick=function(t){var r={},n=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return e.each(n,function(e){e in t&&(r[e]=t[e])}),r},e.extend=function(t){return e.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var r in e)t[r]=e[r]}),t},e.defaults=function(t){return e.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var r in e)(null===t[r]||void 0===t[r])&&(t[r]=e[r])}),t},e.clone=function(t){return t!==Object(t)?t:Array.isArray(t)?t.slice():e.extend({},t)},e}),e("hyperagent/properties",["hyperagent/config","exports"],function(e,t){"use strict";function r(t,r){if(r=r||{},Object(t)!==t)throw Error("The Properties argument must be an object.");e._.extend(t,r.original||{});var n=["_links","_embedded"];Object.keys(t).forEach(function(r){e._.contains(n,r)||(this[r]=t[r])}.bind(this));var i=r.curies;i&&Object.keys(this).forEach(function(e){i.canExpand(e)&&Object.defineProperty(this,i.expand(e),{enumerable:!0,value:this[e]})}.bind(this))}t.Properties=r}),e("hyperagent/resource",["hyperagent/loader","hyperagent/properties","hyperagent/curie","hyperagent/config","exports"],function(e,t,r,n,i){"use strict";function o(e){this._options=e===Object(e)?e:{url:e},this.props=new p({}),this.embedded={},this.links={},this.curies=new h,this.loaded=!1}function s(e,t,r){this._parent=e,this._options=n._.defaults(r||{},{factory:function(e,t){var r=new o(t);return r._load(e),r}}),Object.defineProperties(this,{_parent:{enumerable:!1},_options:{enumerable:!1}}),n._.each(t,function(e,t){Array.isArray(e)?this._setLazyArray(t,e,!0):this._setLazyObject(t,e,!0)}.bind(this));var i=this._options.curies;i&&!i.empty()&&n._.each(t,function(e,t){if(i.canExpand(t)){var r=i.expand(t);Array.isArray(e)?this._setLazyArray(r,e,!1):this._setLazyObject(r,e,!1)}}.bind(this))}function a(e,t){o.call(this,t),this._load(e),this.loaded=!0}function c(e,t){o.call(this,t),this.href=e.href,this.templated=e.templated,this.href?this.templated||this._navigateUrl(this.href):console.warn("Link object did not provide an `href`: ",e),this._load(e)}var u=e.loadAjax,p=t.Properties,h=r.CurieStore;o.factory=function(e){return function(t,r){return new e(t,r)}},o.prototype.fetch=function(){var e=n._.pick(this._options,"headers","username","password","url");return this._options.ajax&&n._.extend(e,this._options.ajax),u(e).then(function(e){return this._parse(e),this.loaded=!0,this}.bind(this))},o.prototype.url=function(){return this._options.url},o.prototype.link=function(e,t){var r=this.links[e];return t&&r.expand(t),r},o.prototype._parse=function(e){var t=JSON.parse(e);this._load(t)},o.prototype._load=function(e){e._links&&(e._links.curies&&(this._loadCuries(e._links.curies),delete e._links.curies),e._links.self&&this._navigateUrl(e._links.self.href),this.links=new s(this,e._links,{factory:o.factory(c),curies:this.curies})),e._embedded&&(this.embedded=new s(this,e._embedded,{factory:o.factory(a),curies:this.curies})),this.props=new p(e,{curies:this.curies,original:this.props})},o.prototype._loadCuries=function(e){return Array.isArray(e)?(e.forEach(function(e){e.templated||console.warn("CURIE links should always be marked as templated: ",e),this.curies.register(e.name,e.href)}.bind(this)),void 0):(console.warn("Expected `curies` to be an array, got instead: ",e),void 0)},o.prototype._navigateUrl=function(e){if(!e)throw Error("Expected absolute or relative URL, but got: "+e);var t=new URI(e);this._options.url=t.is("absolute")?""+t.normalize():"/"===e[0]?""+new URI(this._options.url).resource(e).normalize():""+new URI([this._options.url,e].join("/")).normalize()},s.prototype._setLazyObject=function(e,t,r){Object.defineProperty(this,e,{enumerable:r,get:this._makeGetter(t)})},s.prototype._setLazyArray=function(e,t,r){Object.defineProperty(this,e,{enumerable:r,get:function(){return t.map(function(e){return this._makeGetter(e)()}.bind(this))}})},s.prototype._makeGetter=function(e){var t=this._parent,r=this._options;return function(){return new r.factory(e,n._.clone(t._options))}.bind(this)},n._.extend(a.prototype,o.prototype),n._.extend(c.prototype,o.prototype),c.prototype.expand=function(e){this.templated||console.log("Trying to expand non-templated LinkResource: ",this);var t=""+new URI.expand(this.href,e);this._navigateUrl(t)},c.prototype.toString=function(){return'LinkResource(url="'+this.url()+'")'},i.Resource=o,i.LazyResource=s,i.LinkResource=c}),window.Hyperagent=t("hyperagent")})();